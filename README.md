# PPM-signal-converter
Arduino Nano project that convert analog signal or PWM signal to PPM signal for ESC or servo control

This program can be used on an Arduino Nano to convert an analog or PWM signal to a PPM signal to control an ESC or a servo.

The main intent for this project is to be able to use a brushless motor + ESC with a 8 bit GRBL board (atmel 328P). 8 bit GRBL boards are not capable to generate a proper PPM signal to control an ESC or servo but they can generate a proper PWM signal. so the point of this project is to convert the PWM signal into a PPM signal that the ESC (or servo) can understand.
A manual mode (as opposed to PWM mode) is also possible by adding a rocker switch and a potentiometer to adjust the PPM signal and thus the motor speed (or servo position) manually.

## Why can't 8 bit GRBL boards generate proper PPM signal?
PPM stands for Pulse Position Modulation, it is a signal with a pulse that can be range typically from 1 to 2 milliseconds (can be shortened/extended) and a period of 20 milliseconds. the PPM signal is quite similar to a PWM signal where the period would be 20 milliseconds but the duty cycle would be limited between 5% and 10% (1ms and 2ms).

the PWM signal on GRBL is generated by a 8 bit timer becausde the 16bit timer is already used for other matter, this creates several issues:
1. The minimum period this timer can generate is approx. 16ms instead of 20ms. That might still work for some servos and ESC though
2. The duty cycle can take 256 (8 bit) differente values from 0 to 100%, with the 16ms period, the PPM range is now 6.25% to 12.5% (1ms to 2ms) which translate into 256 * 6.25% = 16 and 256 * 12.5% = 32. So the PPM that can be generated with this timer as only a range of 16 (32 - 16) steps. A standard remote controller has at least 1024 steps. Also generally ESC have a smaller range than 1-2 ms which reduce even more the available steps.

This project uses the same MCU has GRBL (Atmel 328P) but the program uses the 16bits timer1 instead to generate the PPM signal which give a quite precise 20ms period and 2000 steps of precision. However the PWM from the GRBL board is limited to 256 steps anyway which is still better than 16 steps anyway!

### Required material:
- Arduino Nano (or Uno but bulky)

### Optional material for manual mode:
- Potentiometer (10Kohm f.ex)
- 2 position rocker switch

## Power source

The Arduino can be powered by:

- The GRBL board 12V or 5V output
- The ESC Bec (if the ESC is not octo)
- a DC-DC converter (preferable for use with a servo)
- USB

## Connection

For PWM to PPM conversion (PWM Mode)
- PWM signal connects to pin D5 (can be move from D2 to D7, cf. user configuration)
- PPM signal connects to pin D9 (cannot be changed, timer1 compare output)

For Analog to PPM conversion (Manual Mode)
- Analog signal (potentiometer f.ex) connects to pin A0 ((can be move from A0 to A7, cf. user configuration)
- mode selection (rocker switch f.ex) connects to pin D2 (can be move to any pin except: D9 and D13 built-in LED)

### Power:

if the power source is >6V it has to be connected to VIN (pin 30 on Nano)
if power source is <6V, it has to be connected to 5V (pin 27 on Nano) __!! 6V is the absolute maximum voltage to power the Atmega 328P !!__
the ground needs to be connected to both the arduino board and the ESC or Servo (and external power source is present)

## User configuration

There is at the top of the program a section called USER CONFIG where you can configure the pins used for the signals for example (if connection differente than the default described above) 
